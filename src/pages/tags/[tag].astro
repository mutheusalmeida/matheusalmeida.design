---
import ArticlesList from '@/components/ArticlesList.astro'
import TagsLayout from '@/layouts/TagsLayout.astro'
import { getCollection, type CollectionEntry } from 'astro:content'

type Props = {
  articles: CollectionEntry<'articles'>[]
}

export async function getStaticPaths() {
  const articles = await getCollection(
    'articles',
    ({ id, data }) => id.startsWith('en/') && !data.draft
  )

  const tags = [...new Set(articles.map((article) => article.data.tag))]

  const paths = tags.map((tag) => {
    const filteredArticles = articles.filter(
      (article) => article.data.tag === tag
    )

    return {
      params: { tag: tag.toLowerCase() },
      props: { articles: filteredArticles },
    }
  })

  return paths
}

const { tag } = Astro.params
const { articles } = Astro.props
---

<TagsLayout tag={tag}>
  <ArticlesList data={articles} />
</TagsLayout>
